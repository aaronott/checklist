(function () {
    'use strict';
    // var screenshotPath  = app.getPath('appData') + "/" + app.getName() + "/session/screen";
    var screenshotPath  = app.getPath('appData') + "/screen";

    fs.stat(screenshotPath, function (err, stats){
      if (err) {
        fs.mkdirSync(screenshotPath);
      }
    });

    function handleDragOver(e) {
      if (e.preventDefault) {
        e.preventDefault();
      }
    }

    function handleDragLeave(e) { return false; }
    function handleDragEnd(e)   { return false; }

    function handleDragDrop(e) {
      e.preventDefault();

      var file = e.dataTransfer.files[0];
      var files = e.dataTransfer.files;
      var data = {};

      console.log(e.toElement.id);
      var section = e.toElement.id;
      data.section = section

      var copyFileSync = function(srcFile, destFile) {
        var content = fs.readFileSync(srcFile);
        fs.writeFileSync(destFile, content);
      }
      data.files = [];
      for (var f in files) {
        console.log('File you dragged here is', files[f].path);
        if (files[f].path != undefined) {
          console.log(files[f].path)
          // TODO Set this up so that it creates these files in a nice
          // project related directory structure.
          var r = randid(4);

          var path = screenshotPath + "/" + section + "-" + r;
          copyFileSync(files[f].path, path);

          data.files.push(path);
        }
        // console.log('f: ' + f)
      }
      // Save this information to the database.
      saveData('image', data);
      loadZone();
      return false;
    }

    function setDropZones() {
      var dropZones = document.querySelectorAll('.file-drop-zone');

      [].forEach.call(dropZones, function(zone){
        zone.addEventListener('dragover', handleDragOver, false);
        zone.addEventListener('dragleave', handleDragLeave, false);
        zone.addEventListener('dragend', handleDragEnd, false);
        zone.addEventListener('drop', handleDragDrop, false);
      });
    }

    function loadZone() {
      var dropZones = document.querySelectorAll('.file-drop-zone');

      [].forEach.call(dropZones, function(zone){
        console.log("zone_id: " + zone.id)
        var files = fetchFileBySection(zone);
        console.log(files);

      });
    }
    setDropZones();
    loadZone();

    document.getElementById('container').addEventListener('load', setDropZones, false);
    document.getElementById('container').addEventListener('containerLoad', setDropZones, false);
    document.getElementById('container').addEventListener('containerLoad', loadZone, false);

}());
